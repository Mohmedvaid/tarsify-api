# Tarsify API â€” Roadmap

> Track progress here. Update checkboxes after each task is completed.
> Current task details are in `TASK.md` (temporary, replaced each phase).

---

## Phase 1: Core Infrastructure âœ…

- [x] Fastify 5 + TypeScript + ESM setup
- [x] Path aliases (`@/` â†’ `src/`)
- [x] Prisma ORM + PostgreSQL + Docker Compose
- [x] Zod validation schemas
- [x] Error handling (`AppError`, error codes)
- [x] Structured logging (pino)
- [x] Health check endpoints
- [x] Test setup (Vitest) â€” 221 tests passing

## Phase 2: Studio Auth & Notebooks âœ…

- [x] Firebase Admin SDK (dual project)
- [x] Developer auth middleware
- [x] Developer registration, profile, update
- [x] Notebook CRUD (create, read, update, delete)
- [x] Notebook file upload/download/delete (GCS)
- [x] Notebook publish/unpublish workflow
- [x] Notebook validation (.ipynb structure)
- [x] Consumer auth middleware
- [x] Marketplace notebook browse (mock)
- [x] Consumer runs/credits (mock)

## Phase 3: Engine â€” RunPod Integration âœ…

> **What:** Real GPU execution via RunPod Serverless. Dynamic model catalog. Admin, developer, and consumer APIs.

- [x] **Task 0:** Doc cleanup â€” archive old docs, set up new doc structure
- [x] **Task 1:** Database migration â€” delete old Execution model, add engine tables (runpod_endpoints, base_models, tars_models, executions)
- [x] **Task 2:** Engine module structure â€” types, errors, directory
- [x] **Task 3:** RunPod client â€” HTTP wrapper with retry, status mapping
- [x] **Task 4:** Input merger â€” merge user inputs with developer configOverrides
- [x] **Task 5:** Engine core â€” submitJob, getJobStatus, cancelJob
- [x] **Task 6:** Admin routes â€” CRUD for endpoints and base models
- [x] **Task 7:** Developer routes â€” tars model create, configure, publish
- [x] **Task 8:** Consumer routes â€” marketplace browse, run models, poll status
- [x] **Task 9:** Seed script â€” initial data for dev/testing
- [x] **Task 10:** Wire together â€” register routes, env vars, E2E test
- [x] **Task 11:** Update API.md with all new endpoints
- [x] **Bonus:** Unit tests (86%+ coverage, 726 tests)
- [x] **Bonus:** Git hooks (Husky + lint-staged)
- [x] **Bonus:** CI/CD pipeline (GitHub Actions)

## Phase 4: Deploy & Test with Real RunPod â† CURRENT

> **Security Note:** RunPod endpoint IDs are internal and never exposed to frontend.
> Consumers interact via TarsModel slugs. Engine maps internally.

- [x] Deploy SDXL endpoint on RunPod Hub (`qr7wla851k3zrz`)
- [x] Deploy Chatterbox TTS endpoint on RunPod Hub (`9ib1e8vvtjxrwh`)
- [x] Deploy Faster Whisper endpoint on RunPod Hub (`352hhvj1y6v8f6`)
- [x] Deploy to Cloud Run (production)
- [x] Configure CI/CD with GitHub Actions
- [x] Update seed script with real endpoint IDs
- [ ] Add RUNPOD_API_KEY to GCP Secret Manager
- [ ] Seed production database
- [ ] End-to-end test: developer publish â†’ consumer run â†’ get result

## Phase 5: Studio Frontend â€” Tars Models

- [ ] Update tarsify-studio from notebook UI to tars model UI
- [ ] Developer browses base models (GET /api/developer/base-models)
- [ ] Developer creates tars model (picks base, configures, brands)
- [ ] Developer publishes tars model
- [ ] Developer views their published models

## Phase 6: Consumer Frontend â€” Marketplace

- [ ] Update tarsify-web from notebook browse to tars model marketplace
- [ ] Consumer browses published tars models
- [ ] Consumer views model detail + input form (dynamic from input_schema)
- [ ] Consumer runs model, sees loading spinner, gets result
- [ ] Consumer views execution history

## Phase 7: Credits & Billing

- [ ] Credit hold on submit, capture on success, refund on failure
- [ ] Stripe integration for credit purchases
- [ ] Developer earnings tracking (70/30 split)
- [ ] Payout system
- [ ] Add credit_holds and developer_earnings tables

## Phase 8: Production Polish

- [ ] Rate limiting on all routes
- [ ] CORS locked down
- [ ] Error responses sanitized (no stack traces)
- [ ] Auto-retry on RunPod failures (max 2)
- [ ] Execution timeout handling
- [ ] Stale execution cleanup job
- [ ] Monitoring and alerting

## Phase 9: Growth Features ðŸ”®

- [ ] Reviews & ratings
- [ ] Search (PostgreSQL full-text)
- [ ] Developer analytics dashboard
- [ ] Super admin dashboard UI
- [ ] Custom model upload (Path B â€” dedicated RunPod endpoints)
- [ ] Warm pools for popular models
- [ ] Webhook notifications on job completion

---

## Decisions Log

| Date       | Decision                                          | Context                                  |
| ---------- | ------------------------------------------------- | ---------------------------------------- |
| 2026-01-19 | Use Fastify 5 over Express                        | Performance, TypeScript support, plugins |
| 2026-01-19 | Two Firebase projects for auth isolation          | Consumers and developers fully separated |
| 2026-01-20 | GCS for file storage (not local filesystem)       | Cloud Run is ephemeral                   |
| 2026-02-11 | Switch from notebooks to RunPod engine            | Real GPU execution, marketplace model    |
| 2026-02-11 | RunPod Serverless over GCP GPUs                   | Simpler, cheaper, no infra management    |
| 2026-02-11 | Shared endpoints for MVP (not dedicated)          | One SDXL endpoint serves all dev apps    |
| 2026-02-11 | No warm pools for MVP                             | Accept 15-50s cold starts                |
| 2026-02-11 | Dynamic model catalog (DB, not code)              | Add models via admin API, zero deploys   |
| 2026-02-11 | 3-file doc system (ARCHITECTURE + ROADMAP + TASK) | Agent-friendly, no doc sprawl            |
| 2026-02-12 | 80%+ test coverage requirement                    | Code quality, regression prevention      |
| 2026-02-12 | Husky + lint-staged for git hooks                 | Pre-commit lint, pre-push tests          |
| 2026-02-12 | GitHub Actions CI/CD                              | Automated lint, test, build, deploy      |
| 2026-02-12 | RunPod endpoint IDs internal only                 | Never expose to frontend, use TarsModel slugs |
| 2026-02-12 | Seed script for DB setup (no admin UI needed)     | Faster MVP, admin UI can come later      |
